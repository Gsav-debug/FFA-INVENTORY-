<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Babe Inventory - Real QR Codes</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- QR Code Libraries -->
    <script src="https://unpkg.com/qrcode-generator@1.4.4/qrcode.js"></script>
    <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const {
          Search,
          Package,
          Bell,
          Download,
          Trash2,
          Sparkles,
          Heart,
          Star,
          QrCode,
          Plus,
          FileText,
          RotateCcw
        } = lucide.icons;
        // UMD build: .default is the React component
        const LucideIcons = {
          Search: Search.default,
          Package: Package.default,
          Bell: Bell.default,
          Download: Download.default,
          Trash2: Trash2.default,
          Sparkles: Sparkles.default,
          Heart: Heart.default,
          Star: Star.default,
          QrCode: QrCode.default,
          Plus: Plus.default,
          FileText: FileText.default,
          RotateCcw: RotateCcw.default
        };

        const ShopInventory = () => {
          const [products, setProducts] = useState([]);
          const [searchTerm, setSearchTerm] = useState('');
          const [showAddForm, setShowAddForm] = useState(false);
          const [notifications, setNotifications] = useState([]);
          const [selectedProduct, setSelectedProduct] = useState(null);
          const [scannedProduct, setScannedProduct] = useState(null);
          const [newProduct, setNewProduct] = useState({
            name: '',
            category: '',
            quantity: 0,
            lowStockLevel: 5,
            originalCost: 0,
            transportCost: 0,
            shippingCost: 0,
            unitPrice: 0,
            expirationDate: '',
            image: null,
            scanCount: 0,
            dateAdded: new Date().toISOString().split('T')[0]
          });

          // Calculate totals
          const totalProducts = products.length;
          const totalValue = products.reduce((sum, p) => sum + (p.totalValue || 0), 0);
          const totalProfit = products.reduce((sum, p) => sum + (p.profit || 0), 0);
          const lowStockItems = products.filter(p => p.quantity <= p.lowStockLevel).length;

          // ... (all your logic code remains unchanged) ...

          // Generate real QR code using QRious library
          const generateQRCode = (product) => {
            const qrData = {
              type: "PRODUCT_INFO",
              shop: "Boss Babe Inventory - Senegal",
              product: {
                id: product.id,
                name: product.name,
                category: product.category,
                price: `${product.unitPrice.toFixed(0)} CFA`,
                stock: product.quantity,
                expires: product.expirationDate || "No expiration",
                scanCount: product.scanCount,
                dateAdded: product.dateAdded
              },
              timestamp: new Date().toISOString(),
              currency: "CFA",
              contact: "Boss Babe Inventory System",
              url: `https://bossbabe-inventory.com/product/${product.id}`
            };
            try {
              const qr = new QRious({
                element: document.createElement('canvas'),
                value: JSON.stringify(qrData, null, 2),
                size: 256,
                background: '#ffffff',
                foreground: '#8B5CF6',
                level: 'M'
              });
              return qr.toDataURL();
            } catch (error) {
              console.error('QR Code generation failed:', error);
              return generateFallbackQR(product);
            }
          };

          // Fallback QR generator using qrcode-generator
          const generateFallbackQR = (product) => {
            try {
              const qrData = `PRODUCT_INFO|${product.name}|${product.unitPrice}CFA|Stock:${product.quantity}|Boss Babe Inventory - Senegal|ID:${product.id}|Contact:inventory@bossbabe.sn`;
              const qr = qrcode(0, 'M');
              qr.addData(qrData);
              qr.make();
              const canvas = document.createElement('canvas');
              const size = 256;
              canvas.width = size;
              canvas.height = size;
              const ctx = canvas.getContext('2d');
              const moduleCount = qr.getModuleCount();
              const moduleSize = size / moduleCount;
              ctx.fillStyle = '#ffffff';
              ctx.fillRect(0, 0, size, size);
              ctx.fillStyle = '#8B5CF6';
              for (let row = 0; row < moduleCount; row++) {
                for (let col = 0; col < moduleCount; col++) {
                  if (qr.isDark(row, col)) {
                    ctx.fillRect(col * moduleSize, row * moduleSize, moduleSize, moduleSize);
                  }
                }
              }
              return canvas.toDataURL();
            } catch (error) {
              console.error('Fallback QR generation failed:', error);
              return generateSimpleQR(product);
            }
          };

          // Last resort simple QR pattern
          const generateSimpleQR = (product) => {
            const canvas = document.createElement('canvas');
            const size = 256;
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            const modules = 21;
            const moduleSize = size / modules;
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, size, size);
            const dataString = `${product.name}${product.id}${product.unitPrice}`;
            const hash = dataString.split('').reduce((a, b) => {
              a = ((a << 5) - a) + b.charCodeAt(0);
              return a & a;
            }, 0);
            ctx.fillStyle = '#8B5CF6';
            for (let i = 0; i < modules; i++) {
              for (let j = 0; j < modules; j++) {
                const shouldFill = ((hash + i * 17 + j * 23) % 7 < 3) || 
                                  (i < 7 && j < 7 && (i + j) % 3 === 0) ||
                                  (i > modules - 8 && j < 7 && (i - j) % 3 === 0) ||
                                  (i < 7 && j > modules - 8 && (i * j) % 4 === 0);
                if (shouldFill) {
                  ctx.fillRect(j * moduleSize, i * moduleSize, moduleSize, moduleSize);
                }
              }
            }
            const finderSize = moduleSize * 7;
            [[0, 0], [modules - 7, 0], [0, modules - 7]].forEach(([startRow, startCol]) => {
              ctx.fillStyle = '#8B5CF6';
              ctx.fillRect(startCol * moduleSize, startRow * moduleSize, finderSize, finderSize);
              ctx.fillStyle = '#ffffff';
              ctx.fillRect((startCol + 1) * moduleSize, (startRow + 1) * moduleSize, 
                           finderSize - 2 * moduleSize, finderSize - 2 * moduleSize);
              ctx.fillStyle = '#8B5CF6';
              ctx.fillRect((startCol + 2) * moduleSize, (startRow + 2) * moduleSize, 
                           finderSize - 4 * moduleSize, finderSize - 4 * moduleSize);
            });
            return canvas.toDataURL();
          };

          // ... (rest of your logic code unchanged) ...

          // Check for low stock and expiration alerts
          useEffect(() => {
            const alerts = [];
            const today = new Date();
            const thirtyDaysFromNow = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
            products.forEach(product => {
              if (product.quantity <= product.lowStockLevel) {
                alerts.push({
                  type: 'low-stock',
                  message: `${product.name} is running low (${product.quantity} left)`,
                  product: product.name,
                  icon: 'ðŸ“¦'
                });
              }
              if (product.expirationDate) {
                const expDate = new Date(product.expirationDate);
                if (expDate <= thirtyDaysFromNow && expDate > today) {
                  const daysLeft = Math.ceil((expDate - today) / (1000 * 60 * 60 * 24));
                  alerts.push({
                    type: 'expiring',
                    message: `${product.name} expires in ${daysLeft} days`,
                    product: product.name,
                    icon: 'â°'
                  });
                }
              }
            });
            setNotifications(alerts);
          }, [products]);

          // ... (all other logic unchanged) ...

          // Add new product
          const addProduct = () => {
            if (newProduct.name && newProduct.category && newProduct.unitPrice > 0) {
              const product = {
                ...newProduct,
                id: Date.now(),
                totalValue: newProduct.quantity * newProduct.unitPrice,
                profit: (newProduct.unitPrice - newProduct.originalCost - newProduct.transportCost - newProduct.shippingCost) * newProduct.quantity
              };
              setProducts([...products, product]);
              setNewProduct({
                name: '',
                category: '',
                quantity: 0,
                lowStockLevel: 5,
                originalCost: 0,
                transportCost: 0,
                shippingCost: 0,
                unitPrice: 0,
                expirationDate: '',
                image: null,
                scanCount: 0,
                dateAdded: new Date().toISOString().split('T')[0]
              });
              setShowAddForm(false);
            }
          };

          // ... (rest of your logic unchanged) ...

          // Export to Excel
          const exportToExcel = () => {
            try {
              const exportData = products.map(product => ({
                'Product Name': product.name,
                'Category': product.category,
                'Quantity': product.quantity,
                'Unit Price (CFA)': product.unitPrice,
                'Total Value (CFA)': product.totalValue,
                'Low Stock Level': product.lowStockLevel,
                'Original Cost (Â£)': product.originalCost,
                'Transport Cost (Â£)': product.transportCost,
                'Shipping Cost (Â£)': product.shippingCost,
                'Profit (CFA)': product.profit,
                'Expiration Date': product.expirationDate,
                'Scan Count': product.scanCount,
                'Date Added': product.dateAdded
              }));
              const ws = XLSX.utils.json_to_sheet(exportData);
              const wb = XLSX.utils.book_new();
              XLSX.utils.book_append_sheet(wb, ws, 'Inventory');
              XLSX.writeFile(wb, `boss_babe_inventory_${new Date().toISOString().split('T')[0]}.xlsx`);
            } catch (error) {
              alert('Export failed. Please try again.');
            }
          };

          // Export to JSON
          const exportToJSON = () => {
            try {
              const exportData = {
                exportDate: new Date().toISOString(),
                shop: "Boss Babe Inventory - Senegal",
                currency: "CFA",
                exchangeRate: "1Â£ = 750 CFA",
                totalProducts: products.length,
                totalValue: totalValue,
                totalProfit: totalProfit,
                products: products
              };
              const dataStr = JSON.stringify(exportData, null, 2);
              const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
              const exportFileDefaultName = `boss_babe_inventory_${new Date().toISOString().split('T')[0]}.json`;
              const linkElement = document.createElement('a');
              linkElement.setAttribute('href', dataUri);
              linkElement.setAttribute('download', exportFileDefaultName);
              linkElement.click();
            } catch (error) {
              alert('Export failed. Please try again.');
            }
          };

          // ... (rest of your logic unchanged) ...

          // Clear all data
          const clearAllData = () => {
            if (window.confirm('âš ï¸ Are you sure you want to clear all data? This will permanently delete all products and cannot be undone!')) {
              setProducts([]);
              setNotifications([]);
              setSelectedProduct(null);
              setScannedProduct(null);
              setSearchTerm('');
              alert('âœ… All data has been cleared successfully!');
            }
          };

          // Filter products based on search
          const filteredProducts = products.filter(product =>
            product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
            product.category.toLowerCase().includes(searchTerm.toLowerCase())
          );

          // ... (rest of your logic unchanged) ...

          // Now, in your JSX, use LucideIcons.X for all icons:
          return (
            <div className="min-h-screen bg-gradient-to-br from-pink-100 via-purple-50 to-indigo-100 p-4">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="text-center mb-8">
                  <div className="flex items-center justify-center gap-2 mb-4">
                    <LucideIcons.Sparkles className="text-pink-500 w-8 h-8" />
                    <h1 className="text-4xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
                      âœ¨ Boss Babe Inventory âœ¨
                    </h1>
                    <LucideIcons.Heart className="text-pink-500 w-8 h-8" />
                  </div>
                  <p className="text-gray-600 text-lg">Track your empire like the CEO you are ðŸ’–</p>
                  <p className="text-sm text-gray-500 mt-2">ðŸ”„ Now with REAL scannable QR codes!</p>
                </div>
                {/* ...rest of your JSX, updating all icon usages as above... */}
              </div>
            </div>
          );
        };

        // Render the app (React 18+ compatibility)
        if (ReactDOM.createRoot) {
          ReactDOM.createRoot(document.getElementById('root')).render(<ShopInventory />);
        } else {
          ReactDOM.render(<ShopInventory />, document.getElementById('root'));
        }
    </script>
</body>
</html>
